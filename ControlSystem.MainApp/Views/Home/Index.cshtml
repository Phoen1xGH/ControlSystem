@using ControlSystem.Domain.Entities;

@model List<UpdateInfo>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<style>
    body, html {
        
        overflow: hidden;
        background-color: #30353c;
    }

    .outer-div {
        height: 92.4vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .about-site {
/*        border-radius: 20px;*/
        border-bottom: 1px solid #d8d8d8;
        color: #d8d8d8;
        padding: 20px;
        /*width: 700px;*/
        margin-top: 27px;
        margin-left: 324px;
        margin-right: 324px;
    }

    .update-info {
        border-radius: 20px;
        border: 1px solid #d8d8d8;
        display: flex;
        flex-direction: column;
        color: #d8d8d8;
        padding: 20px;
        width: 100%;
        /*width: 700px;*/
        height: 100%;
        /*min-height: 400px;*/
       /* height: 500px;*/
        overflow: auto;

    }

    .updinfo-wrapper {
        overflow: hidden;
        border-radius: 20px;
        display: flex;
        /*width: 700px;*/
        margin-right: 10px;
        margin: 20px auto auto auto;
        height: 100vh;
        margin-left: 324px;
        margin-right: 324px;
    }

    .patch-note{
        border-radius: 20px;
        border: 1px solid transparent;
        width: 100%;
        padding: 20px;
        background-color: #3c414a;
        cursor: pointer;
        margin-top: 10px;
        margin-bottom: 10px;
        display: flex;
        flex-direction: column;
    }

    .patch-note:hover {
        border: 1px solid #d8d8d8;
    }

    ::-webkit-scrollbar {
        width: 7px; /* Ширина скролла */
        background-color: transparent; /* Прозрачный фон */
    }

    ::-webkit-scrollbar-thumb {
        background-color: #87909e; /* Цвет скролла */
        border-radius: 6px; /* Радиус скролла */
    }

    ::-webkit-scrollbar-track {
        background-color: transparent; /* Прозрачный трек */
    }

    ::-o-scrollbar-thumb {
        background-color: #87909e;
        border-radius: 6px;
    }

    ::-o-scrollbar {
        width: 12px;
        background-color: transparent;
    }

    ::-o-scrollbar-track {
        background-color: transparent;
    }

    #patch-date {
        margin-left: auto;
    }

    #patch-version {
        font-weight: bold;
    }

    .version-wrapper {
        display: flex;
        flex-direction: row;
        margin-bottom: 10px;
        cursor: pointer;
    }

    #patch-date,
    #patch-version,
    #patch-topic {
        cursor: pointer;
    }

    .full-patch-note {
        display: flex;
        flex-direction: column;
        border-bottom: 1px solid #d8d8d8;
        padding-bottom: 10px;
    }

    .modalInfo {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: 20px;
        padding: 35px;
        background-color: #30353c;
        z-index: 2;
        height: 400px;
        width: 600px;
        color: #d8d8d8;
    }

    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1;
    }
    
    .site-info {
        text-align: center;
    }

    .title-bordered {
        border-bottom: 1px solid #d8d8d8;
        padding: 10px;
    }

    .slogan {
        width: 100%;
        margin-bottom: 20px;
    }

</style>

<div class="outer-div">
    <div class="about-site">
        <h3 class="site-info title-bordered">Time Sense Workflow</h3>
        <label class="site-info slogan">@ViewBag.InfoTitle</label>
        <label>@ViewBag.AboutSite</label>
    </div>
    <div class="updinfo-wrapper">
        <div class="update-info">
            @foreach(var patch in Model)
            {
                <div class="patch-note" 
                    onclick="openFullInfo(`@patch.Description`, `@patch.Topic`,
                                    `@patch.Date.ToString("dd.MM.yyyy")`, `@patch.Version`)">

                    <div class="version-wrapper">
                        <label id="patch-version">
                            Обновление @patch.Version
                        </label>
                        <label id="patch-date">[@patch.Date.ToString("dd.MM.yyyy")]</label>
                    </div>
                    <label id="patch-topic" class="topic">&#8211; @patch.Topic</label>
                </div>
            }
        </div>
    </div>
</div>


<div id="full-info" class="modalInfo">
    <div class="full-patch-note">
        <div class="version-wrapper">
            <label id="patch-version" style="cursor: default"></label>
            <label id="patch-date" style="cursor: default"></label>
        </div>
        <label id="patch-topic" style="cursor: default"></label>
    </div>

    <div style="margin-top: 10px;  height: 250px; overflow: auto">
        <label id="patch-description"></label>
    </div>
</div>
<div id="overlay" class="overlay" onclick="closeFullInfo()"></div>


<script>
    function openFullInfo(
        description, topic, 
        dateString, version) {

        $(".modalInfo").find("#patch-version").text('Обновление: ' + version);
        $(".modalInfo").find("#patch-date").text(dateString);

        topic = topic.replace(/\n/g, "<br>");

        $(".modalInfo").find("#patch-topic").html(topic);

        description = description.replace(/\n/g, "<br>")
                                 .replace(/\t/g, "&nbsp;&nbsp;&nbsp;&nbsp;");

        $(".modalInfo").find("#patch-description").html(description);

        document.getElementById('full-info').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
    }

    function closeFullInfo() {
        document.getElementById('full-info').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    $(".topic").each(function() {
        
        var labelText = $(this).text();
        
        labelText = labelText.replace(/\n/g, "<br>");
        
        $(this).html(labelText);
    });
</script>